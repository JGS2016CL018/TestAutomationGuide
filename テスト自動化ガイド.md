# テスト自動化ガイド

## 目次
1. テスト自動化の心得
1. テスト自動化対象の選定
  1. 「効くところ」を見極める(定量面)
  1. 「効くところ」を見極める(定性面)
1. テスト自動化の実装方式
  1. テスト自動化推奨モデル
  1. モデル毎の実装方式
1. テスト自動化の参考書籍・サイト
  1. テスト自動化の必要性・メリット・デメリットについて
  1. 体系的・網羅的な知識を得たい
  1. どんなテストツールがあるか知りたい
  1. テスト自動化に取り組んでいるものの上手くいっていない
  1. テスト自動化について勉強したい

## 本ガイドの対象読者チェック
本ガイドは以下の質問に対し、全て「Yes」と回答出来る方を対象としています。
- 対象システムがWebですか？
- 開発端末、サーバにSeleniumなどの自動化ソフトの導入が可能ですか？
- サンプルコードを参照しながら、プログラミングを行うことが可能ですか？
- テスト自動化に対する熱意はありますか？
- 担当業務が忙しすぎませんか？

## 本ガイドの目的
テスト自動化をしようとしている人に対して、目的や対象となるシステム・機能に応じた、おススメのテスト自動化プランを提案します。

## 1. テスト自動化の心得
テスト自動化を行うにあたり、各種論文や研究発表において語られている、おさえておくべきポイントのうち、代表的なものを記述します。

1. テスト自動化でコストは下がらない
  - コストが下がるのはテスト実行部分のみ
  - テスト準備やテストスクリプトのメンテナンスなどのコストが発生する
1. 効果が出やすいおいしいところ(効くところ)を優先して自動化する
  - 全てを100%自動化する必要はない (完全な自動化にこだわらず、手動テストと自動テスト、それぞれの良いところを活かす)
  - 投資対効果を意識して、自動化するテストに優先順位を付ける
1. 自動化しやすいシステム設計・実装を心がける
  - HTMLタグにIDを振る
  - 機能を疎結合にする
  - デバッグしやすくする
1. 自動化対象はテスト以外にも存在する
  - ビルド、デプロイなど、テスト以外の部分の自動化も効果あり
  - テストの一部分だけを自動化するのもあり (実行 → 結果取得 → 検証 のうち、実行だけを自動化するなど)

#### 自動テストと手動テストのコスト比較
##### コスト構造
1. 自動テストの場合のコスト
 1. テストスクリプト作成・修正 (初期コスト)
 1. テスト実行 (実質コストゼロ)
 1. テスト結果検証 (テスト実行の都度発生するコスト)
 1. 問題発生時の調査・デバッグ (問題発生時に発生するコスト)
1. 手動テストの場合のコスト
 1. テスト実行 (テスト実行の都度発生するコスト)
 1. テスト結果検証 (テスト実行の都度発生するコスト)
 1. 問題発生時の調査・デバッグ (問題発生時に発生するコスト)

* 自動テストのコスト = [1.1] + [1.3] × テスト実行回数 + [1.4] × 問題発生回数
* 手動テストのコスト = ( [2.1] + [2.2] ) × テスト実行回数 + [2.3] × 問題発生回数

##### 簡易的な計算式
自動テストも手動テストも、テスト結果検証([1.3], [2.2])、問題発生時の調査・デバッグ([1.4], [2.3])のコストに大差がないと仮定した場合

* [1.1]自動テストのテストスクリプト作成・修正 < [2.1]手動テストのテスト実行 × テスト実行回数

という式が成立すれば、テスト自動化で元が取れることになります。  
以下の条件が満たせるかがポイントになると言えます。

* [1.1]自動テストのテストスクリプト作成・修正のコストが低い
* [2.1]手動テストのテスト実行の実行回数が多い

##### 留意点
* テストスクリプト作成・修正のコストについて  
テスト自動化に取り組み始めた時期は、この部分のコストが高くなりがちです。  
経験や慣れで中長期的にコストが平準化していく部分もあるので、あせらずに進めましょう。  
標準化やコーディング規約の整備により、保守性を高めコストを下げることも可能です。余裕があれば検討して下さい。

* テスト結果検証、調査・デバッグのコストについて  
手動テストの場合、テストが失敗したことに、そのタイミングで気付くことができます。  
自動テストが失敗した場合は、テスト結果のみを情報源として、どこで失敗したのか？原因はなにか？を調査する必要があります。  
自動テストの結果として、適切な情報が残っていない場合、原因調査・デバッグに手動テスト以上に時間がかかる場合もあります。

## 2. テスト自動化対象の選定
スモールスタートを意識して、テスト自動化の対象範囲(画面・機能・テスト内容)を検討しましょう。  
100%自動化は将来の夢と割り切り、できるところから自動化を始めて、ノウハウ・成功事例を蓄積しつつ、少しずつ自動化の範囲を広げていきましょう。  
この章では、テスト自動化の対象範囲を絞り込む際のヒントを提示します。  
できれば、テスト自動化対象システムの画面・機能の一覧表などを用意してから、以下の内容を参照してください。

### 1. 「効くところ」を見極める(定量面)
テスト自動化の心得として記載した、「効くところ」とは、具体的にはどういうところでしょう？  
代表例は以下のような投資対効果の高いところです。少ない投資で高い効果を得ることが期待できます。
* 簡単に自動化できるところ(操作が単純でスクリプト化が簡単なもの)
* 繰り返し実行するところ(回帰テスト、クロスブラウザテスト、同一のシナリオに対して複数データでテストをする場合など)

逆に、以下のようなところでは、自動化による効果を得ることは困難です。
* 成功・失敗を機械的に判断することが難しい(画面表示のズレなど、人が目視で確認しなければ気付けない。)
* 仕様が確定していない(スクリプトを頻繁に修正しなければならない。スクリプトによる自動テストが安定しない。)
* 1回しか実行しないテスト
* 利用頻度の低い機能

### 2. 「効くところ」を見極める(定性面)
定量的な投資対効果では測ることができない自動化の効果もあります。  
例えば、手間がかかる作業を自動化することができれば、  
現場のメンバーのモチベーションアップ、生産性向上など、定性的な面での様々な効果が期待できます。  

以下の質問内容に該当する場合は、後述する推奨モデルを適用することで、効果的なテスト自動化ができると期待できます。

|質問内容|推奨モデル|
|-|-|
|いつも同じような打鍵をしている。|1, 2|
|クロスブラウザテストで同じ作業を繰り返す。|7, 9|
|エビデンスの取得が大変（種類・残し方）。|3|
|データパターンが多く、テスト打鍵のボリュームが多い。|4|
|回帰テストのパターンが多く、手間がかかる。|5, 8|
|画面遷移がパターンが多い。|6|

## 3. テスト自動化の実装方式
テスト自動化の実装方式については、インターネット上で様々な情報を得ることができます。  
この章では、代表的なテスト自動化パターンを推奨モデルとして提示するとともに、実装方式についてヒントとなる事例を紹介します。

### 1. テスト自動化推奨モデル
テスト自動化を「効くところ」に適用する場合の、推奨モデルについて例示します。
* CR … キャプチャ＆リプレイ
* PO … ページオブジェクト
* DD … データドリブン

|#|対象画面|推奨モデル|説明|難易度|サンプル|
|-|-|-|-|:---:|:---:|
|1|単一画面|データを入力するだけのCR|テストデータを作る際の補助ツールとして|低|-|
|2||デフォルトバリューでのPO|1の保守性を高めたい場合はPO化も|中|有|
|3||エビデンスを取得するだけのPO|登録処理前後のエビデンス(画面ショット・DBダンプ)を取得する便利ツール|高|有|
|4||データファイルを用意してDD＆PO|データ項目・データパターンが多い画面を限定的に|高|有|
|5|複数画面|シナリオテストをCR|スモークテストをサクッと|低|-|
|6|||特定の画面までの遷移をバッチ化して、ちょっと便利に|低|-|
|7|||クロスブラウザテストを(使い捨てでも良い派)|中|-|
|8|||ストレートコンバージョン、ファームウェア・ミドルウェア更新時の無影響確認(新旧比較)|中|-|
|9||シナリオテストをPO|クロスブラウザテストを(ちゃんと保守していきたい派)|高|-|

###### 細かく検討する余裕がない場合は、とりあえずこれ
* 手動打鍵でテストをする際に、Seleniumで記録する（推奨モデル #5）
  - 「ログイン」「テスト対象画面への遷移」「テスト対象画面での打鍵」など、シナリオを細かく分けて記録しておくと、再利用し易くなる
* データ項目・データパターンが多い、登録系画面についてはDD&POで作り込む(推奨モデル #4)
* それ以外のテストについては、CRでサクッと(推奨モデル #1)
* 繰り返し使う、且つ、保守していきたいテストについて優先順位をつけてPOで書き換えていく

### 2. モデル毎の実装方式
|No.1|データを入力するだけのキャプチャ＆リプレイ|
|-|-|
|難易度|低(★☆☆)|
|実装方式|対象画面へのデータ入力を自動化するスクリプトを、キャプチャ＆リプレイで実装する。最初に手動テストをする際に、Firefox(Selenium IDE)で操作を記録してスクリプトを作成する。|
|利用イメージ|対象画面を開いた状態でスクリプトを実行し、テストデータの入力に限定して自動化する。スクリプトはあくまで補助的に利用することが前提。スクリプト実行後に、必要な項目を手動で変更しテストを実行する。(デフォルトバリューパターンに近いイメージ)|
|推奨画面|登録系画面|
|留意点|キャプチャ＆リプレイは、操作を記録して作成したスクリプトを、そのまま利用できるという点がメリット。複雑な処理を記述したい場合は、プログラミング言語で実装した方が良い。([Selenium IDE]での記述方式を学習するコストが新たに発生してしまうのを避ける)|

|No.2|デフォルトバリューでのページオブジェクト|
|-|-|
|難易度|中(★★☆)|
|実装方式|No.1のスクリプトを[Selenium IDE]の機能でプログラムコードに変換する。jarファイル化して、バッチファイルをダブルクリックして実行できるようにすると、更に便利に。|
|利用イメージ|No.1とほぼ同様。プログラミングすることで、＋α(スクリーンショットを取得するなど)の機能を追加することもできる。|
|推奨画面|登録系画面|
|留意点|一定のプログラミングスキル・クラス設計スキルが求められるため、中級者以上の方向け。ページオブジェクトの設計方針・設計思想を統一しておくと、保守コストを低く抑えることが可能。|

|No.3|エビデンスを取得するだけのページオブジェクト|
|-|-|
|難易度|中(★★☆)|
|実装方式|「登録前の画面のスクリーンショットを取得 → 登録ボタン押下 → 登録後の画面のスクリーンショットを取得 → DB・テーブルの内容を取得」 など、エビデンス取得の一連の操作をスクリプト化。ライブラリ化して、バッチファイルをダブルクリックして実行できるようにすると、更に便利に。|
|利用イメージ|画面へのデータ入力は手動(あるいはNo.1, 2のスクリプトを利用)で行い、その後の定型的な操作をスクリプトで実行する。エビデンスの取得漏れを防止し、取得ルール(命名規則・フォーマット)を順守させることができる。|
|推奨画面|登録系画面|
|留意点|No.2と同様。|

|No.4|データドリブン＆ページオブジェクト|
|-|-|
|難易度|中(★★★★)|
|実装方式|入力項目が多い登録系画面について、データ入力・登録・エビデンス取得などの一連の操作をページオブジェクトで実装。|
|利用イメージ|入力データのバリエーションを変えて、同じ操作を行う場合に有効。入力データをExcel等で用意し、繰り返し登録し続けるイメージ。大量のテストデータを仕込む場合などにも利用可能であり、応用が利く実装方式です。|
|推奨画面|登録系画面|
|留意点|-|

|No.5|シナリオテストをキャプチャ＆リプレイ|
|-|-|
|難易度|低(★☆☆)|
|実装方式|スモークテスト(プログラムの主要機能が動くかどうかの最低限のテスト)を、キャプチャ＆リプレイで実装する。広く浅く、単純な基本操作(システム起動、画面遷移、ボタン・リンククリック操作など)を、Firefox(Selenium IDE)で記録してスクリプトを作成する。|
|推奨画面|参照系画面|
|利用イメージ|ビルドしたソフトウェアをテスト環境に展開する前にスクリプトを実行し、最低限の操作(システムが起動する、主要機能が動作する)が可能な状態であることを確認する。そもそも動かない(テストにならない)ソフトウェアがテスト環境に展開されることを防ぎ、テストの効率化を実現する。|
|留意点|-|

|No.6|特定の画面までの遷移をバッチ化して、ちょっと便利に|
|-|-|
|難易度|低(★☆☆)|
|実装方式|特定の画面までの遷移をキャプチャ＆リプレイで実装する。ライブラリ化して、バッチファイルをダブルクリックして実行できるようにすると、更に便利に。|
|利用イメージ|複数の画面を経由しないと辿り着かない画面や、よくある画面遷移のパターンをスクリプト化して、手動作業を軽減します。|
|推奨画面|参照系画面|
|留意点|-|

|No.7|クロスブラウザテストをキャプチャ＆リプレイで|
|-|-|
|難易度|中(★★☆)|
|実装方式|対象画面のテストスクリプトを、キャプチャ＆リプレイで実装する。最初に手動テストをする際に、Firefox(Selenium IDE)で操作を記録してスクリプトを作成する。|
|利用イメージ|クロスブラウザテストは必ず2回以上は同じ作業を繰り返すことになります。初回のテストをキャプチャして、そのスクリプトを利用してテストを行うことで、高い投資対効果が期待できます。|
|推奨画面|参照系画面|
|留意点|-|

|No.8|無影響確認テスト(新旧比較)をキャプチャ＆リプレイで|
|-|-|
|難易度|中(★★☆)|
|実装方式|無影響確認テスト(新旧比較)のスクリプトを、キャプチャ＆リプレイで実装する。最初に手動テストをする際に、Firefox(Selenium IDE)で操作を記録してスクリプトを作成する。|
|利用イメージ|無影響確認テスト(新旧比較)は必ず2回以上は同じ作業を繰り返すことになります。初回のテストをキャプチャして、そのスクリプトを利用してテストを行うことで、高い投資対効果を得られると期待できます。|
|推奨画面|参照系画面|
|留意点|-|

|No.9|クロスブラウザテストをページオブジェクトで|
|-|-|
|難易度|高(★★★)|
|実装方式|No.5～8のスクリプトを[Selenium IDE]の機能でプログラムコードに変換する。|
|利用イメージ|複数回利用するスクリプトの場合は、ページオブジェクトパターンで実装し、保守性を高めることも検討してみましょう。|
|推奨画面|参照系画面|
|留意点|-|



## 4. テスト自動化の参考書籍・サイト
この章では、テスト自動化に取り組む際に必要となる、有益な情報・ヒントを与えてくれる書籍・サイトを紹介します。  
テスト自動化については、優れた先駆者による数多くの研究成果が残されており、ここで紹介する書籍・サイトは、そうした研究成果のごく一部です。  
ご自身の知りたいテーマについて学習し、テスト自動化についての理解を深めるきっかけになれば幸いです。

#### 1. テスト自動化の必要性・メリット・デメリットについて
|No.1|「なぜテスト自動化が必要なのか？」|
|-|-|
|概要|テスト自動化の必要性・メリット・注意点について、簡潔・明瞭・的確にわかりやすく語られています(わずか3ページの記事ですが必要十分です)。「なぜテスト自動化が必要なのか？」について、自信を持って語れない方は、ぜひご一読ください。<br>※全文を参照するには無料会員登録が必要ですが、本連載に限らず、他にも参考になる記事が多いので、この機会に登録することをお薦めします。|
|サイト|実践！テスト自動化の勘所 ～ テスト自動化とツールの導入 [ITpro]|
|Link|http://itpro.nikkeibp.co.jp/article/COLUMN/20120919/423474/|


#### 2. 体系的・網羅的な知識を得たい

|No.2|1時間でわかるSTA|
|-|-|
|概要|「システムテスト自動化 標準ガイド」を紹介しつつ、エッセンスとなる情報を盛り込んだ資料。タイトル通り"1時間でわか(った気になれ)る"資料なので、まずはこの資料に目を通してみることをお薦めします。|
|発表|システムテスト自動化カンファレンス2014|
|Link|http://www.slideshare.net/k_suzuki/1sta-stac2014|

|No.3|システムテスト自動化 標準ガイド|
|-|-|
|概要|テスト自動化に取り組むにあたり、必要となる知識・情報を体系的・網羅的に扱った一冊。ボリュームはあるものの、真剣にテスト自動化に取り組むのであれば必読です。|
|出版|翔泳社|
|Link|http://www.shoeisha.co.jp/book/detail/9784798139210|


#### 3. どんなテストツールがあるか知りたい

|No.4|現場ですぐ使えるソフトウェアテストツール|
|-|-|
|概要|多くのテストツールの中から、Java、Webアプリケーションに対応したものを中心に、現場で利用し易いフリーのツールに限定して紹介。テストツールについての知識が少ない方は、まずはこの資料に目を通してみることをお薦めします。|
|発表|ソフトウェアテストシンポジウム 2011 四国|
|Link|http://www.jasst.jp/archives/jasst11t/pdf/s1.pdf|

|No.5|テストツールまるわかりガイド(入門編)|
|-|-|
|概要|テストツールについて体系的・網羅的に扱った資料。単なるツールの紹介に留まらず、"テスト"についての体系的な知識・理解を得ることもできる資料となっています。「あなたのプロジェクト 健康診断」や「テストツールマップ」など便利なツールも用意されていますので、ぜひご利用ください。|
|発表|NPO法人 ソフトウェアテスト技術振興協会|
|Link|http://www.aster.or.jp/business/testtool_wg/pdf/Testtool_beginningGuide_Version1.0.0.pdf|


#### 4. テスト自動化に取り組んでいるものの上手くいっていない

|No.6|テスト自動化のパターンと実践|
|-|-|
|概要|テスト自動化は難しく、みんなが共通してハマる罠・"あるある"が結構あります。テスト自動化に取り組んでいる人たちの経験をアクセスしやすい形で公開しよう。というプロジェクト活動についての紹介と、代表的なパターンを紹介した資料。<br>※こちらの資料で興味がわいた方は、是非後述のサイト[テスト自動化パターン言語プロジェクト]にもアクセスしてください。|
|発表|システムテスト自動化カンファレンス2014|
|Link|http://www.slideshare.net/Posaune/ss-42682479|

|No.7|テスト自動化パターン言語プロジェクト|
|-|-|
|概要|テスト自動化の暗黙知について、パターン言語へとまとめる試みを行っているプロジェクト。テスト自動化の推奨パターン・アンチパターン・良くある落とし穴などが、わかりやすいキーワードで語られています。現場への導入・運用に苦労している方は、自分のプロジェクトがアンチパターンにハマっていないか、確認してみてはいかがでしょう？|
|発表|テスト自動化パターン言語プロジェクト|
|Link|http://kencolle.github.io/AutomationPatternLanguage/|

|No.8|よりよいテスト自動化のためにちょっと考えてみませんか？～スコープ、ROI、プロセスを中心に～|
|-|-|
|概要|単なる"テスト自動化"ではなく、"**よい**テスト自動化"を達成するための、考え方やヒントが語られています。テスト自動化ができているという方にも一読頂きたい資料です。|
|発表|システムテスト自動化カンファレンス2013|
|Link|http://www.slideshare.net/omn/stac2013-openingkoukai|

#### 5. テスト自動化について勉強したい
|No.9|システムテスト自動化カンファレンス|
|-|-|
|概要|テスト自動化研究会(STAR: Software Test Automation Research Group Jp)の旗艦イベント。<br><br><i>**システムテストの自動化に関する正しい知識とノウハウを共有し、ゲンバを進化させよう。**</i><br><br>をテーマにした、システムテストの自動化に特化したイベントです。<br>過去の発表資料はどれも有益なものばかりですので、ぜひ一通り目を通してみてください。|
|Link|https://sites.google.com/site/testautomationresearch/event|


|No.10|ソフトウェアテストシンポジウム|
|-|-|
|概要|NPO法人 ソフトウェアテスト技術振興協会（ASTER:Association of Software Test EngineeRing）主催のイベント。<br>ソフトウェア業界全体のテスト技術力の向上と、進化した技術や知識の普及をテーマに、ソフトウェアテスト全般を扱ったシンポジウムで、歴史も古く老舗といえると思います。<br>テスト自動化に関連した研究発表も当然ありますが、それ以外にも、テスト技術者としてのスキルアップに繋がる研究発表も多く残されています。<br>過去の発表資料は膨大なので、まずはご自身が興味を惹かれるものから、少しずつ目を通していくとよいと思います。|
|Link|http://www.jasst.jp/|


|No.11|ソフトウェア品質シンポジウム|
|-|-|
|概要|財団法人 日本科学技術連盟に設置されたSQiPソフトウェア品質委員会(SQiP:Software Quality Profession)主催のイベント。<br>ソフトウェア品質に関する実践的な技術・経験・研究成果を共有し、意見交換を行う場として設定されたシンポジウムです。<br>"品質"というテーマを基軸としつつ、多種多様な研究発表が残されており、新しい視点を与えてくれるのではないかと思います。|
|Link|https://www.juse.jp/sqip/symposium/|


|No.12|テスト自動化研究会|
|-|-|
|概要|テスト自動化研究会(STAR: Software Test Automation Research Group Jp)へようこそ。<br><br>本会では、ソフトウェアテスティングにおける重要な実践技術である<br>「テスト自動化」(特に上層、システムテスト/受け入れテスト)について、<br>技術領域の定義と啓蒙、およびそれを主たる価値とする<br>「テスト自動化エンジニア」(Automator)という職業の国内における創造を推進しています。<br>([ようこそ] より)|
|Link|https://sites.google.com/site/testautomationresearch/|


|No.13|ソフトウェアテスト技術振興協会|
|-|-|
|概要|特定非営利活動法人（NPO法人）ソフトウェアテスト技術振興協会（ASTER:Association of Software Test EngineeRing）を2006年4月に設立しました。 ASTERは、ソフトウェアテストシンポジウム（JaSST）をはじめとする、ソフトウェア品質向上に関する教育や調査研究、普及振興事業を行います。 これらの事業を通して、ソフトウェア品質向上に関する社会教育の推進および専門能力の開発を実現します。 最終的には、社会全体で品質が高いソフトウェアの流通と活用がなされることで高度情報化社会の発展に寄与することを目的としています。<br>([NPO ASTER 設立のご挨拶] より)|
|Link|http://aster.or.jp/|


|No.14|ソフトウェア品質委員会|
|-|-|
|概要|実践的で実証的なソフトウェア品質技術・施策の研究・普及を目的として、日本科学技術連盟の下に設置されたソフトウェア品質向上のための活動です。 SQiPは、「ソフトウェア品質を良くしたい」という思いを共有する方なら、誰でも参加できるオープンな場です。<br>([SQiPとは] より)|
|Link|http://juse.or.jp/sqip/index.html|
